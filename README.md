# fake-mdbci

Fakes MDBCI with Vagrant and a few scripts.

## Usage

- Copy `Vagrantfile` to `~/vms/develop/`.

- Copy `create_network_file.py` to `~/vms/`.

- Run `cd ~/vms/develop/ && vagrant up --no-parallel`

- Run `cd ~/vms/ && ./create_network_file.py`

- Run `echo 'GALERA_BACKEND,MAXSCALE,REPL_BACKEND,SECOND_MAXSCALE' > ~/vms/develop_configured_labels`

- Export the config name with `export mdbci_config_name=develop`

- Build tests

- Run a test

## Copying Sources From a Local Copy

Here's a bash function that can be called to rsync the source from the local
`~/MaxScale` directory into the `~/MaxScale` directory on a VM. The
`develop_ssh_config` file is generated by running
`vagrant ssh-config > ../develop_ssh_config` inside the `~/vms/develop`
directory.

```
function mxs_sync_vm() {
    vm=maxscale_000

    if [ ! -z "$1" ]
    then
        vm=$1
    fi

    rsync --delete -a --progress -e "ssh -F $HOME/vms/develop_ssh_config" ~/MaxScale/ vagrant@${vm}:~/MaxScale/
}
```
